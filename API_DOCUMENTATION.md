# üìö Tempo Box - Documenta√ß√£o da API

## üåê URLs de Acesso

### Produ√ß√£o
- **Aplica√ß√£o**: https://tempo-box.a3sitsolutions.com.br
- **Swagger UI**: https://tempo-box.a3sitsolutions.com.br/swagger-ui.html
- **API Docs (JSON)**: https://tempo-box.a3sitsolutions.com.br/v3/api-docs
- **Health Check**: https://tempo-box.a3sitsolutions.com.br/actuator/health

### Desenvolvimento
- **Aplica√ß√£o**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **API Docs (JSON)**: http://localhost:8080/v3/api-docs

## üìñ Vis√£o Geral

O **Tempo Box** √© uma API REST para upload e compartilhamento tempor√°rio de arquivos com controle de expira√ß√£o autom√°tica. Ideal para compartilhamento de builds, artefatos CI/CD, documentos tempor√°rios e muito mais.

### üéØ Principais Funcionalidades

- üìÅ **Upload de arquivos** com dura√ß√£o personalizada (at√© 100MB)
- üîí **Autentica√ß√£o por token** est√°tico para seguran√ßa
- üë§ **Filtragem por ID Token** para organiza√ß√£o de arquivos por usu√°rio/contexto
- ‚è∞ **Auto-expira√ß√£o** baseada em tempo configur√°vel
- üóÇÔ∏è **Metadados customiz√°veis** (reposit√≥rio, commit, branch, etc.)
- üîÑ **Limpeza autom√°tica** de arquivos expirados
- üåê **Interface web** para gerenciamento manual
- üìä **API completa** para integra√ß√£o autom√°tica

## üîê Autentica√ß√£o

### Auth Token (Obrigat√≥rio)
Todas as opera√ß√µes de upload requerem um **Auth Token** v√°lido:
```
authToken: "tempo-box-admin-token-2024"
```

### ID Token (Opcional)
Para filtrar arquivos por usu√°rio/contexto espec√≠fico:
```
idToken: "token-identification-xpto"
```

### Access Token
Para download de arquivos (gerado automaticamente ou customizado):
```
accessToken: "custom-access-token-123"
```

## üõ†Ô∏è Endpoints da API

### üì§ Upload de Arquivo

**POST** `/api/files/upload`

Faz upload de um arquivo com tempo de vida configur√°vel.

#### Par√¢metros (Form Data)

| Par√¢metro | Tipo | Obrigat√≥rio | Descri√ß√£o | Exemplo |
|-----------|------|-------------|-----------|---------|
| `file` | File | ‚úÖ | Arquivo a ser enviado (m√°x 100MB) | `arquivo.zip` |
| `storageDurationMinutes` | Integer | ‚úÖ | Tempo de vida em minutos | `1440` |
| `authToken` | String | ‚úÖ | Token de autentica√ß√£o | `tempo-box-admin-token-2024` |
| `idToken` | String | ‚ùå | Token de identifica√ß√£o √∫nico | `token-identification-xpto` |
| `accessToken` | String | ‚ùå | Token personalizado para download | `custom-token-123` |
| `repository` | String | ‚ùå | Nome do reposit√≥rio Git | `meu-projeto` |
| `commit` | String | ‚ùå | Hash do commit Git | `abc1234567890` |
| `commitMessage` | String | ‚ùå | Mensagem do commit | `feat: nova funcionalidade` |
| `branch` | String | ‚ùå | Nome da branch Git | `main` |
| `runId` | String | ‚ùå | ID da execu√ß√£o CI/CD | `12345` |
| `actor` | String | ‚ùå | Autor do commit/execu√ß√£o | `developer@example.com` |
| `apkName` | String | ‚ùå | Nome do APK (Android) | `app-release.apk` |
| `downloadUrl` | String | ‚ùå | URL alternativa de download | `https://example.com/file` |

#### Exemplo de Requisi√ß√£o

```bash
curl -X POST 'https://tempo-box.a3sitsolutions.com.br/api/files/upload' \
  -F 'file=@"arquivo.zip"' \
  -F 'authToken="tempo-box-admin-token-2024"' \
  -F 'idToken="token-identification-xpto"' \
  -F 'storageDurationMinutes="1440"' \
  -F 'repository="meu-projeto"' \
  -F 'branch="main"' \
  -F 'commit="abc123"'
```

#### Resposta de Sucesso (200)

```json
{
  "fileId": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "accessToken": "custom-access-token-123",
  "message": "File uploaded successfully",
  "expiresInMinutes": 1440
}
```

#### Poss√≠veis Erros

| C√≥digo | Descri√ß√£o | Exemplo |
|--------|-----------|---------|
| 401 | Token inv√°lido | `{"error": "Unauthorized", "message": "Invalid authentication token"}` |
| 500 | Erro no upload | `{"error": "Upload failed", "message": "IO exception occurred"}` |

---

### üì• Download de Arquivo

**GET** `/api/files/download/{fileId}`

Faz download de um arquivo espec√≠fico.

#### Par√¢metros

| Par√¢metro | Localiza√ß√£o | Obrigat√≥rio | Descri√ß√£o | Exemplo |
|-----------|-------------|-------------|-----------|---------|
| `fileId` | Path | ‚úÖ | ID √∫nico do arquivo | `a1b2c3d4-e5f6-7890-abcd-ef1234567890` |
| `Access-Token` | Header | ‚úÖ | Token de acesso | `custom-access-token-123` |

#### Exemplo de Requisi√ß√£o

```bash
curl -X GET 'https://tempo-box.a3sitsolutions.com.br/api/files/download/a1b2c3d4-e5f6-7890-abcd-ef1234567890' \
  -H 'Access-Token: custom-access-token-123' \
  -o arquivo_baixado.zip
```

#### Resposta de Sucesso (200)
Retorna o arquivo bin√°rio para download.

#### Poss√≠veis Erros

| C√≥digo | Descri√ß√£o | Exemplo |
|--------|-----------|---------|
| 401 | Token/arquivo inv√°lido | `{"error": "Unauthorized", "message": "Invalid file ID or access token"}` |
| 404 | Arquivo n√£o encontrado | `{"error": "File Not Found", "message": "File could not be found on server"}` |
| 410 | Arquivo expirado | `{"error": "File Expired", "message": "File has expired", "expiredAt": "2024-01-15T10:30:00"}` |

---

## üåê Interface Web

### Login com ID Token

A interface web agora suporta login com ID Token para filtrar arquivos:

1. **Auth Token**: Token de autentica√ß√£o principal
2. **ID Token**: Token para filtrar apenas seus arquivos (opcional)

### URLs da Interface

- **Homepage**: `/`
- **Login**: `/login` 
- **√Årea de arquivos**: `/files`
- **Logout**: `/logout`
- **Login direto (Auth Token)**: `/auth/{authToken}`
- **Login direto (Auth + ID Token)**: `/auth/{authToken}/{idToken}`

---

### üîó Login Autom√°tico via URL

Para facilitar a integra√ß√£o e acesso direto, voc√™ pode usar URLs que fazem login automaticamente:

#### Login apenas com Auth Token
```
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024
```
- Faz login autom√°tico
- Mostra todos os arquivos do Auth Token

#### Login com Auth Token + ID Token
```
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/token-identification-xpto
```
- Faz login autom√°tico
- Filtra apenas arquivos do ID Token especificado
- Ideal para contextos espec√≠ficos (usu√°rio, projeto, CI/CD)

#### Exemplos Pr√°ticos

**Para usu√°rios espec√≠ficos:**
```bash
# Usu√°rio Jo√£o
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/user-joao

# Usu√°rio Maria  
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/user-maria
```

**Para projetos espec√≠ficos:**
```bash
# Projeto A
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/project-a

# Projeto B
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/project-b
```

**Para builds CI/CD:**
```bash
# Build de produ√ß√£o
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/production-builds

# Build de desenvolvimento
https://tempo-box.a3sitsolutions.com.br/auth/tempo-box-admin-token-2024/dev-builds
```

---

## üîß Integra√ß√£o com CI/CD

### GitHub Actions

Exemplo de uso em workflow do GitHub Actions:

```yaml
- name: Upload Build Artifact
  run: |
    curl -X POST 'https://tempo-box.a3sitsolutions.com.br/api/files/upload' \
      -F 'file=@"build/app.zip"' \
      -F 'authToken="${{ secrets.TEMPO_BOX_TOKEN }}"' \
      -F 'idToken="github-${{ github.actor }}"' \
      -F 'storageDurationMinutes="2880"' \
      -F 'repository="${{ github.repository }}"' \
      -F 'branch="${{ github.ref_name }}"' \
      -F 'commit="${{ github.sha }}"' \
      -F 'commitMessage="${{ github.event.head_commit.message }}"' \
      -F 'actor="${{ github.actor }}"' \
      -F 'runId="${{ github.run_id }}"'
```

### Jenkins

```groovy
pipeline {
    agent any
    stages {
        stage('Upload Artifact') {
            steps {
                sh '''
                    curl -X POST 'https://tempo-box.a3sitsolutions.com.br/api/files/upload' \
                      -F 'file=@"dist/app.jar"' \
                      -F 'authToken="${TEMPO_BOX_TOKEN}"' \
                      -F 'idToken="jenkins-${BUILD_USER}"' \
                      -F 'storageDurationMinutes="1440"' \
                      -F 'repository="${JOB_NAME}"' \
                      -F 'branch="${GIT_BRANCH}"' \
                      -F 'commit="${GIT_COMMIT}"' \
                      -F 'runId="${BUILD_NUMBER}"'
                '''
            }
        }
    }
}
```

---

## üìä Casos de Uso

### 1. Compartilhamento de Builds
```bash
# Upload de build de aplica√ß√£o
curl -X POST 'https://tempo-box.a3sitsolutions.com.br/api/files/upload' \
  -F 'file=@"app-v1.2.3.apk"' \
  -F 'authToken="tempo-box-admin-token-2024"' \
  -F 'idToken="android-builds"' \
  -F 'storageDurationMinutes="4320"' \
  -F 'apkName="app-v1.2.3.apk"'
```

### 2. Artefatos de CI/CD
```bash
# Upload de artefato com metadados completos
curl -X POST 'https://tempo-box.a3sitsolutions.com.br/api/files/upload' \
  -F 'file=@"release.zip"' \
  -F 'authToken="tempo-box-admin-token-2024"' \
  -F 'idToken="ci-cd-releases"' \
  -F 'storageDurationMinutes="10080"' \
  -F 'repository="my-app"' \
  -F 'branch="release/v1.2.3"' \
  -F 'commit="abc123def456"' \
  -F 'commitMessage="release: version 1.2.3"'
```

### 3. Documentos Tempor√°rios
```bash
# Upload de documento com vida curta
curl -X POST 'https://tempo-box.a3sitsolutions.com.br/api/files/upload' \
  -F 'file=@"relatorio.pdf"' \
  -F 'authToken="tempo-box-admin-token-2024"' \
  -F 'idToken="documentos-temporarios"' \
  -F 'storageDurationMinutes="60"'
```

---

## üõ°Ô∏è Seguran√ßa

### Tokens de Seguran√ßa
- **Auth Token**: Controla acesso ao upload
- **Access Token**: Controla acesso ao download
- **ID Token**: Organiza e filtra arquivos por contexto

### Headers de Seguran√ßa
- Frame Deny
- Content Type NoSniff  
- XSS Filter
- Referrer Policy

### Limita√ß√µes
- Tamanho m√°ximo: 100MB por arquivo
- Tempo m√≠nimo: 1 minuto
- Tempo m√°ximo: Configur√°vel (padr√£o sem limite)

---

## ‚ö° Performance

### Cache
- Cache de layers Docker para builds
- Cache de depend√™ncias Gradle
- Headers de cache HTTP

### Limpeza Autom√°tica
- Execu√ß√£o a cada hora (configur√°vel)
- Remo√ß√£o de arquivos expirados
- Limpeza de registros do banco

---

## üîç Monitoramento

### Health Checks
- **Aplica√ß√£o**: `/actuator/health`
- **Informa√ß√µes**: `/actuator/info`

### Logs
- Upload e download de arquivos
- Autentica√ß√£o e sess√µes
- Limpeza autom√°tica
- Erros e exce√ß√µes

---

## üê≥ Deploy com Docker

### Vari√°veis de Ambiente

```yaml
environment:
  - SPRING_PROFILES_ACTIVE=docker
  - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/tempo_box
  - SPRING_DATASOURCE_USERNAME=admin
  - SPRING_DATASOURCE_PASSWORD=admin
  - APP_AUTH_STATIC_TOKEN=tempo-box-admin-token-2024
  - APP_VERSION=1.0.0
```

### Docker Compose

```yaml
version: '3.8'
services:
  tempo-box:
    image: a3s.nexus.maranguape.a3sitsolutions.com.br/tempo-box:latest
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    labels:
      - "traefik.http.routers.tempo-box.rule=Host(`tempo-box.a3sitsolutions.com.br`)"
```

---

## üöÄ Exemplos Pr√°ticos

### Upload com JavaScript

```javascript
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('authToken', 'tempo-box-admin-token-2024');
formData.append('idToken', 'my-unique-id');
formData.append('storageDurationMinutes', '1440');

fetch('https://tempo-box.a3sitsolutions.com.br/api/files/upload', {
    method: 'POST',
    body: formData
})
.then(response => response.json())
.then(data => {
    console.log('Upload successful:', data);
    // data.fileId e data.accessToken para download
});
```

### Download com Python

```python
import requests

headers = {
    'Access-Token': 'custom-access-token-123'
}

response = requests.get(
    'https://tempo-box.a3sitsolutions.com.br/api/files/download/file-id-here',
    headers=headers
)

if response.status_code == 200:
    with open('downloaded_file.zip', 'wb') as f:
        f.write(response.content)
    print('Download successful!')
```

---

## üìû Suporte

### Contato
- **Email**: contato@a3sitsolutions.com.br
- **Website**: https://a3sitsolutions.com.br

### Issues
- **GitHub**: Reporte problemas no reposit√≥rio oficial

### Documenta√ß√£o
- **Swagger UI**: Interface interativa completa
- **README.md**: Documenta√ß√£o de instala√ß√£o e configura√ß√£o
- **API_DOCUMENTATION.md**: Este documento

---

**üéâ Tempo Box - Compartilhamento tempor√°rio de arquivos de forma simples e segura!**